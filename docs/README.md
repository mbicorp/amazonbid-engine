# Amazon Bid Engine ドキュメント

## 概要

Amazon Bid Engine は、Amazon広告（Sponsored Products）の入札額を自動的に最適化するための提案エンジンです。

キーワードごとのパフォーマンス指標（CVR、ACOS、CTRなど）を分析し、最適な入札額の変更を提案します。

## このツールが解決する問題

1. **手動入札の限界**: 数千〜数万のキーワードを人間が手動で最適化するのは不可能
2. **リアルタイム対応**: 競合状況やパフォーマンス変化への即座対応
3. **セール期間対応**: S_MODE（セールモード）での攻めの入札戦略
4. **TOS（Top of Search）戦略**: 検索結果上位表示のための入札最適化
5. **ライフサイクル管理**: 商品ステージに応じた投資戦略の自動切り替え
6. **SEO投資最適化**: オーガニック順位向上のための長期赤字投資判断
7. **Slack通知**: ライフサイクル変更・強制HARVESTアラートの自動通知
8. **ネガティブキーワード候補検出**: 統計的に安全な方法（ルールオブスリー）で無駄なキーワードを特定

## システム構成図

```
┌─────────────────────────────────────────────────────────────────┐
│                        Cloud Scheduler                          │
│                    (定期実行トリガー)                            │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Cloud Run (API Server)                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    server.ts                             │   │
│  │  - /health          (ヘルスチェック)                     │   │
│  │  - /recommend       (API経由での入札提案)                │   │
│  │  - /cron/run        (汎用Cronジョブ)                     │   │
│  │  - /cron/run-normal (通常モード定期実行)                 │   │
│  │  - /cron/run-smode  (セールモード定期実行)               │   │
│  │  - /lifecycle/*     (ライフサイクル管理)                 │   │
│  │  - /jungle-scout/*  (市場データ分析)                     │   │
│  │  - /unified/*       (統合戦略)                           │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
          │                                           │
          ▼                                           ▼
┌─────────────────────┐                 ┌─────────────────────────┐
│   Amazon Ads API    │                 │       BigQuery          │
│  (キーワードデータ)  │                 │  (実行履歴・推奨履歴)   │
└─────────────────────┘                 │  (ライフサイクルデータ) │
          │                             └─────────────────────────┘
          ▼                                           │
┌─────────────────────┐                               │
│  Jungle Scout API   │◄──────────────────────────────┘
│  (市場データ)       │
└─────────────────────┘
          │
          ▼
┌─────────────────────┐
│     Slack API       │
│  (ライフサイクル通知)│
└─────────────────────┘
```

## コア処理フロー

```
入力: KeywordMetrics[] + GlobalConfig
              │
              ▼
┌─────────────────────────────────────┐
│ 1. アクション決定 (action-logic.ts) │
│    - CVR変化率計算                  │
│    - ACOS差分計算                   │
│    - アクションタイプ決定           │
│      (STRONG_UP/MILD_UP/KEEP/...)   │
└─────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│ 2. TOS判定 (tos-logic.ts)           │
│    - TOS攻め対象判定                │
│    - TOS 200%許可判定               │
└─────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│ 3. 係数計算 (coefficients.ts)       │
│    - フェーズ係数                   │
│    - CVR係数                        │
│    - ランクギャップ係数             │
│    - 競合係数                       │
│    - ブランド係数                   │
│    - リスク係数                     │
│    - 統計係数                       │
│    - TOS係数                        │
└─────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│ 4. 入札額計算 (bid-calculation.ts)  │
│    - 基本変化率算出                 │
│    - 係数適用                       │
│    - クリップ処理（上限/下限）      │
└─────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────┐
│ 5. 理由生成 (reason-generator.ts)   │
│    - Facts (事実)                   │
│    - Logic (判断根拠)               │
│    - Impact (影響予測)              │
└─────────────────────────────────────┘
              │
              ▼
出力: BidRecommendation[]
```

## ドキュメント一覧

| ファイル | 内容 |
|---------|------|
| [architecture.md](./architecture.md) | システムアーキテクチャ・処理フロー・BigQueryスキーマ |
| [bid_core.md](./bid_core.md) | 入札コアロジック・関数詳細・ネガティブキーワード計算 |
| [BID_LOGIC.md](./BID_LOGIC.md) | 入札ロジック詳細（アクション決定） |
| [COEFFICIENTS.md](./COEFFICIENTS.md) | 係数計算ロジック詳細 |
| [API.md](./API.md) | APIリファレンス |
| [SETUP.md](./SETUP.md) | セットアップガイド |
| [LIFECYCLE.md](./LIFECYCLE.md) | ライフサイクル管理システム |
| [LTV.md](./LTV.md) | LTV（顧客生涯価値）ベースのACOS計算 |
| [FULL_SPECIFICATION.md](./FULL_SPECIFICATION.md) | 完全仕様書 |

## クイックスタート

```bash
# 依存関係インストール
npm install

# ビルド
npm run build

# テスト実行
npm test

# サーバー起動
npm start
```

## 主要な型定義

### KeywordMetrics（入力）
キーワードごとのパフォーマンス指標。詳細は [ARCHITECTURE.md](./ARCHITECTURE.md) を参照。

### BidRecommendation（出力）
入札変更の推奨結果。詳細は [BID_LOGIC.md](./BID_LOGIC.md) を参照。

### GlobalConfig（設定）
システム全体の設定。詳細は [SETUP.md](./SETUP.md) を参照。

## ライセンス

MIT License

---

*更新日: 2025年1月*
